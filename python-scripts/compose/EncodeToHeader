# -*- coding: utf-8 -*-

import base64

# Wykonuj tylko jesli istnieje zaznaczenie
if buffer.get_selection_bounds() != ():
    buffer = clawsmail.compose_window.text.get_buffer()     # pobierz caly tekst wiadomosci

    (start, end) = buffer.get_selection_bounds()            # pobierz poczatek i koniec zaznaczenia

    message = start.get_text(end)                           # pobierz zaznaczony fragment wiadomosci

    buffer.delete(start, end)                               # usun zaznaczony fragment wiadomosci

    headers = clawsmail.compose_window.get_header_list()    # pobierz naglowki

    secrets = [h[1] for h in headers if h[0] == "SS:"]      # pobierz z naglowkow dodane wczesniej fragmenty

    for s in secrets:                                       # dodaj do siebie fragmenty
        message += "\n--\n" + base64.b64decode(s)

    encoded = base64.b64encode(message)                     # zakoduj wiadomosc

    clawsmail.compose_window.add_header("SS:", encoded)     # zapisz zakodowana wiadomosc w naglowku 'SS:'

# vim: ft=python
